<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Html5Exporter Tests</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .test-results {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test {
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 4px;
        }
        .test.passed {
            background: #d4edda;
            color: #155724;
        }
        .test.failed {
            background: #f8d7da;
            color: #721c24;
        }
        .test .name {
            font-weight: 500;
        }
        .test .error {
            font-size: 0.9em;
            margin-top: 4px;
            color: #856404;
        }
        .summary {
            margin-top: 20px;
            padding: 15px;
            background: #e9ecef;
            border-radius: 4px;
            font-size: 1.1em;
        }
        .summary.all-passed {
            background: #d4edda;
            color: #155724;
        }
        .summary.has-failures {
            background: #f8d7da;
            color: #721c24;
        }
        #log {
            margin-top: 20px;
            padding: 15px;
            background: #2d2d2d;
            color: #f8f8f2;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            margin-bottom: 20px;
        }
        button:hover {
            background: #2980b9;
        }
    </style>
</head>
<body>
    <h1>Html5Exporter Tests</h1>

    <button onclick="runTests()">Run Tests</button>

    <div id="results" class="test-results">
        <p>Click "Run Tests" to execute the test suite.</p>
    </div>

    <div id="log"></div>

    <!-- Load dependencies -->
    <script src="/libs/jszip/jszip.min.js"></script>

    <!-- Load exporter classes -->
    <script src="../BaseExporter.js"></script>
    <script src="../Html5Exporter.js"></script>

    <!-- Load tests -->
    <script src="Html5Exporter.test.js"></script>

    <script>
        // Capture console output
        const logElement = document.getElementById('log');
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn,
        };

        const appendLog = (type, args) => {
            const prefix = type === 'error' ? '❌ ' : type === 'warn' ? '⚠️ ' : '';
            logElement.textContent += prefix + args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : a).join(' ') + '\n';
            logElement.scrollTop = logElement.scrollHeight;
        };

        console.log = (...args) => {
            originalConsole.log(...args);
            appendLog('log', args);
        };
        console.error = (...args) => {
            originalConsole.error(...args);
            appendLog('error', args);
        };
        console.warn = (...args) => {
            originalConsole.warn(...args);
            appendLog('warn', args);
        };

        async function runTests() {
            const resultsDiv = document.getElementById('results');
            logElement.textContent = '';
            resultsDiv.innerHTML = '<p>Running tests...</p>';

            try {
                const results = await window.Html5ExporterTests.runHtml5ExporterTests();

                let html = '';
                results.forEach(r => {
                    const statusClass = r.passed ? 'passed' : 'failed';
                    const icon = r.passed ? '✓' : '✗';
                    html += `<div class="test ${statusClass}">
                        <span class="name">${icon} ${r.name}</span>
                        ${r.error ? `<div class="error">${r.error}</div>` : ''}
                    </div>`;
                });

                const passed = results.filter(r => r.passed).length;
                const failed = results.filter(r => !r.passed).length;
                const summaryClass = failed === 0 ? 'all-passed' : 'has-failures';

                html += `<div class="summary ${summaryClass}">
                    Tests: ${results.length} | Passed: ${passed} | Failed: ${failed}
                </div>`;

                resultsDiv.innerHTML = html;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="test failed">
                    <span class="name">Test execution failed</span>
                    <div class="error">${error.message}</div>
                </div>`;
                console.error('Test execution error:', error);
            }
        }
    </script>
</body>
</html>
