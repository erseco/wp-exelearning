<!--
 *
 *
 * @author Josh Lobe
 * http://ultimatetinymcepro.com
 
 * i18n mechanism by Ignacio Gros (http://gros.es/). See i18n.js
 */
 -->

<script>
    (function() {
        var jqueryPath;
        try {
            // Use 'top' to access main window (this iframe is inside TinyMCE dialog)
            var mainWindow = top;

            // Check if we're in static mode using capabilities first, then fallback
            var capabilities = mainWindow && mainWindow.eXeLearning && mainWindow.eXeLearning.app && mainWindow.eXeLearning.app.capabilities;
            var isStaticMode = capabilities
                ? !capabilities.storage.remote
                : (mainWindow && mainWindow.__EXE_STATIC_MODE__);

            // In static mode, use relative path from codemagic.html's location
            // codemagic.html is at: libs/tinymce_5/js/tinymce/plugins/codemagic/
            // jQuery is at: libs/jquery/jquery.min.js
            // So we need to go up 5 directories: ../../../../../jquery/jquery.min.js
            if (isStaticMode) {
                jqueryPath = '../../../../../jquery/jquery.min.js';
            } else {
                // Server mode: use basePath from config (new) or symfony (legacy)
                var config = mainWindow && mainWindow.eXeLearning && mainWindow.eXeLearning.config;
                var basePath = '';
                if (config && typeof config === 'string') {
                    try { config = JSON.parse(config); } catch(e) { config = null; }
                }
                if (config && config.basePath) {
                    basePath = config.basePath;
                } else if (mainWindow && mainWindow.eXeLearning && mainWindow.eXeLearning.symfony && mainWindow.eXeLearning.symfony.basePath) {
                    basePath = mainWindow.eXeLearning.symfony.basePath;
                }
                jqueryPath = basePath + '/libs/jquery/jquery.min.js';
            }
        } catch(e) {
            // Fallback for server mode
            jqueryPath = '/libs/jquery/jquery.min.js';
        }
        document.write('<script src="' + jqueryPath + '"><\/script>');
    })();
</script>
<script type="text/javascript" src="includes/codemirror/codemirror.js"></script>
<script type="text/javascript" src="includes/batched_scripts.js"></script>
<script type="text/javascript" src="includes/i18n.js"></script>
<script type="text/javascript" src="includes/codemagic.js"></script>

<link rel="stylesheet" href="includes/codemagic.css" />
<link rel="stylesheet" href="includes/codemirror/codemirror.css" />

<div id="body">

	<div id="wrapline">
        <input type="checkbox" name="wraptext" id="wraptext" checked="checked" /> %Wrap_text%
        <input type="checkbox" name="autocompletion" id="autocompletion" checked="checked" /> %Auto_completion%
        <input type="checkbox" name="highlighting" id="highlighting" checked="checked" /> %Highlight_Code%
        <span id="maximizeEditorWrapper"><input type="checkbox" name="maximizeEditor" id="maximizeEditor" /> %Full_Screen%</span>
    </div>
    <div style="clear: both;"></div>

	 <div class="editor-buttons">
        <a id="undo" class="disabled" title="%Undo%"><img src="images/icons/undo.png" alt="%Undo%" /> %Undo%</a>
        <a id="redo" class="disabled" title="%Redo%"><img src="images/icons/redo.png" alt="%Redo%" /> %Redo%</a>
        <a id="search_replace" title="%Search_and_Replace%"><img src="images/icons/lens.png" alt="%Search_and_Replace%" /> %Search_and_Replace%</a>
        <a id="re_beautify" title="%Format_HTML_Code%"><img src="images/icons/file.png" alt="%Format_HTML_Code%" /> %Reformat%</a>
    </div>  
    <div style="clear:both;"></div>
    
    <div id="search_panel">
    	<span id="search_query"><label for="query">%Search%</label>: <input id="query" type="text" class="form-control" /></span>
        <span id="replace_query"><label for="replace">%Replace%</label>: <input id="replace" type="text"  class="form-control" /></span>
        <span id="search_button"><input id="search_code" type="submit" value="%Search%" class="btn-default" /></span>
        <span id="replace_button"><input id="replace_code" type="submit" value="%Replace%" class="btn-default" /></span>
    </div>
    <div style="clear:both;"></div>

	<textarea name="htmlSource" id="htmlSource" rows="25" cols="100" class="htmlSource"></textarea>
	
    <div class="mceActionPanel">
        <button id="codemagic_cancel" class="btn-default">%Cancel%</button> <button id="codemagic_insert" class="btn-primary">%Insert_and_Close%</button>
    </div>
</div>