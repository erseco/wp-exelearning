{
  "$schema": "https://playground.wordpress.net/blueprint-schema.json",
  "preferredVersions": {
    "php": "latest",
    "wp": "latest"
  },
  "siteOptions": {
    "blogname": "WordPress Playground eXeLearning Demo"
  },
  "steps": [
    {
      "step": "setSiteLanguage",
      "language": "es_ES"
    },
    {
      "step": "installPlugin",
      "pluginData": {
        "resource": "url",
        "url": "https://github.com/erseco/wp-exelearning/archive/refs/heads/main.zip"
      },
      "options": {
        "activate": true
      }
    },
    {
      "step": "runPHP",
      "code": "<?php require_once '/wordpress/wp-load.php'; global $wp_rewrite; $wp_rewrite->set_permalink_structure('/%postname%/'); $wp_rewrite->flush_rules(true); ?>"
    },
    {
      "step": "runPHP",
      "code": "<?php require_once '/wordpress/wp-load.php'; require_once ABSPATH . 'wp-admin/includes/file.php'; require_once ABSPATH . 'wp-admin/includes/media.php'; require_once ABSPATH . 'wp-admin/includes/image.php'; $plugin_dir = WP_PLUGIN_DIR; $source_file = null; foreach (glob($plugin_dir . '/*/test-content.elpx') as $file) { $source_file = $file; break; } if (!$source_file) { foreach (glob($plugin_dir . '/*/*/test-content.elpx') as $file) { $source_file = $file; break; } } if ($source_file && file_exists($source_file)) { $file_content = file_get_contents($source_file); $upload = wp_upload_bits('test-content.elpx', null, $file_content); if (!$upload['error']) { $file_path = $upload['file']; $file_url = $upload['url']; $attachment = array('post_mime_type' => 'application/zip', 'post_title' => 'Contenido de ejemplo', 'post_content' => '', 'post_status' => 'inherit', 'guid' => $file_url); $attach_id = wp_insert_attachment($attachment, $file_path); if (!is_wp_error($attach_id)) { update_attached_file($attach_id, $file_path); $upload_dir = wp_upload_dir(); $unique_hash = sha1($file_path . time()); $destination = trailingslashit($upload_dir['basedir']) . 'exelearning/' . $unique_hash . '/'; wp_mkdir_p($destination); $zip = new ZipArchive; if ($zip->open($file_path) === TRUE) { $zip->extractTo($destination); $zip->close(); $has_preview = file_exists($destination . 'index.html') ? '1' : '0'; update_post_meta($attach_id, '_exelearning_extracted', $unique_hash); update_post_meta($attach_id, '_exelearning_has_preview', $has_preview); update_post_meta($attach_id, '_exelearning_version', '3'); echo 'Extracted to ' . $unique_hash . ' has_preview=' . $has_preview; } else { echo 'Zip extract failed'; } } else { echo 'Insert error'; } } else { echo 'Upload error: ' . $upload['error']; } } else { echo 'Source not found in ' . $plugin_dir; } ?>"
    },
    {
      "step": "runPHP",
      "code": "<?php require_once '/wordpress/wp-load.php'; $attachment_id = 0; $attachments = get_posts(array('post_type' => 'attachment', 'posts_per_page' => 1, 'post_status' => 'any', 'orderby' => 'ID', 'order' => 'DESC')); if (!empty($attachments)) { $attachment_id = $attachments[0]->ID; $has_preview = get_post_meta($attachment_id, '_exelearning_has_preview', true); echo 'Found attachment ' . $attachment_id . ' has_preview=' . $has_preview; } $post_content = $attachment_id ? '<!-- wp:exelearning/elp-upload {\"attachmentId\":' . $attachment_id . ',\"height\":600} /-->' : '<!-- wp:paragraph --><p>No se pudo cargar el contenido eXeLearning.</p><!-- /wp:paragraph -->'; wp_update_post(array('ID' => 1, 'post_title' => 'Ejemplo de contenido eXeLearning', 'post_content' => $post_content, 'post_status' => 'publish')); ?>"
    }
  ],
  "features": {
    "networking": true
  },
  "login": true,
  "landingPage": "/wp-admin/post.php?post=1&action=edit"
}
