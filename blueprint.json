{
  "$schema": "https://playground.wordpress.net/blueprint-schema.json",
  "preferredVersions": {
    "php": "latest",
    "wp": "latest"
  },
  "siteOptions": {
    "blogname": "WordPress Playground eXeLearning Demo"
  },
  "steps": [
    {
      "step": "setSiteLanguage",
      "language": "es_ES"
    },
    {
      "step": "installPlugin",
      "pluginData": {
        "resource": "url",
        "url": "https://github.com/erseco/wp-exelearning/archive/refs/heads/main.zip"
      },
      "options": {
        "activate": true
      }
    },
    {
      "step": "runPHP",
      "code": "<?php require_once '/wordpress/wp-load.php'; global $wp_rewrite; $wp_rewrite->set_permalink_structure('/%postname%/'); $wp_rewrite->flush_rules(true); ?>"
    },
    {
      "step": "runPHP",
      "code": "<?php require_once '/wordpress/wp-load.php'; require_once ABSPATH . 'wp-admin/includes/file.php'; require_once ABSPATH . 'wp-admin/includes/media.php'; require_once ABSPATH . 'wp-admin/includes/image.php'; $plugin_dir = WP_PLUGIN_DIR; $source_file = null; foreach (glob($plugin_dir . '/*/test-content.elpx') as $file) { $source_file = $file; break; } if (!$source_file) { foreach (glob($plugin_dir . '/*/*/test-content.elpx') as $file) { $source_file = $file; break; } } if ($source_file && file_exists($source_file)) { $tmp_file = '/tmp/test-content.elpx'; copy($source_file, $tmp_file); $_FILES['async-upload'] = array('name' => 'test-content.elpx', 'type' => 'application/zip', 'tmp_name' => $tmp_file, 'error' => 0, 'size' => filesize($tmp_file)); $attach_id = media_handle_upload('async-upload', 0, array('post_title' => 'Contenido de ejemplo para probar estilos y catalogacion')); if (!is_wp_error($attach_id)) { echo 'Attachment created: ' . $attach_id; } else { echo 'Error: ' . $attach_id->get_error_message(); } } ?>"
    },
    {
      "step": "runPHP",
      "code": "<?php require_once '/wordpress/wp-load.php'; $attachment_id = 0; $attachments = get_posts(array('post_type' => 'attachment', 'posts_per_page' => 1, 'post_status' => 'any', 'orderby' => 'ID', 'order' => 'DESC')); if (!empty($attachments)) { $attachment_id = $attachments[0]->ID; } $post_content = $attachment_id ? '<!-- wp:exelearning/elp-upload {\"attachmentId\":' . $attachment_id . ',\"height\":600} /-->' : '<!-- wp:paragraph --><p>No se pudo cargar el contenido eXeLearning.</p><!-- /wp:paragraph -->'; wp_update_post(array('ID' => 1, 'post_title' => 'Ejemplo de contenido eXeLearning', 'post_content' => $post_content, 'post_status' => 'publish')); ?>"
    }
  ],
  "features": {
    "networking": true
  },
  "login": true,
  "landingPage": "/wp-admin/post.php?post=1&action=edit"
}
