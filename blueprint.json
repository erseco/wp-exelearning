{
  "$schema": "https://playground.wordpress.net/blueprint-schema.json",
  "preferredVersions": {
    "php": "latest",
    "wp": "latest"
  },
  "siteOptions": {
    "blogname": "WordPress Playground eXeLearning Demo"
  },
  "steps": [
    {
      "step": "setSiteLanguage",
      "language": "es_ES"
    },
    {
      "step": "installPlugin",
      "pluginData": {
        "resource": "url",
        "url": "https://github.com/erseco/wp-exelearning/archive/refs/heads/main.zip"
      },
      "options": {
        "activate": true
      }
    },
    {
      "step": "runPHP",
      "code": "<?php require_once '/wordpress/wp-load.php'; global $wp_rewrite; $wp_rewrite->set_permalink_structure('/%postname%/'); $wp_rewrite->flush_rules(true); ?>"
    },
    {
      "step": "runPHP",
      "code": "<?php require_once '/wordpress/wp-load.php'; require_once ABSPATH . 'wp-admin/includes/file.php'; require_once ABSPATH . 'wp-admin/includes/media.php'; require_once ABSPATH . 'wp-admin/includes/image.php'; $plugin_dir = WP_PLUGIN_DIR; $source_file = null; foreach (glob($plugin_dir . '/*/test-content.elpx') as $file) { $source_file = $file; break; } if (!$source_file) { foreach (glob($plugin_dir . '/*/*/test-content.elpx') as $file) { $source_file = $file; break; } } if ($source_file && file_exists($source_file)) { $file_content = file_get_contents($source_file); $upload = wp_upload_bits('contenido-ejemplo.elpx', null, $file_content); if (!$upload['error']) { $file_path = $upload['file']; $file_url = $upload['url']; $attachment = array('post_mime_type' => 'application/zip', 'post_title' => 'Contenido de ejemplo eXeLearning', 'post_content' => '', 'post_status' => 'inherit', 'guid' => $file_url); $attach_id = wp_insert_attachment($attachment, $file_path); if (!is_wp_error($attach_id)) { update_attached_file($attach_id, $file_path); $upload_dir = wp_upload_dir(); $unique_hash = sha1($file_path . time()); $destination = trailingslashit($upload_dir['basedir']) . 'exelearning/' . $unique_hash . '/'; wp_mkdir_p($destination); $zip = new ZipArchive; if ($zip->open($file_path) === TRUE) { $zip->extractTo($destination); $zip->close(); $has_preview = file_exists($destination . 'index.html') ? '1' : '0'; update_post_meta($attach_id, '_exelearning_extracted', $unique_hash); update_post_meta($attach_id, '_exelearning_has_preview', $has_preview); update_post_meta($attach_id, '_exelearning_version', '3'); } } } } ?>"
    }
  ],
  "features": {
    "networking": true
  },
  "login": true,
  "landingPage": "/wp-admin/post-new.php"
}
